"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[2656],{"./src/components/views/dialogs/TransactionHistoryDialog.tsx":(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a("./node_modules/react/index.js"),s=a("./src/components/views/dialogs/BaseDialog.tsx"),o=a("./src/components/views/elements/Spinner.tsx"),r=a("./src/MatrixClientPeg.ts"),l=a("./src/stores/spaces/SpaceStore.ts");function i(e){const[t,a]=(0,n.useState)([]),[i,c]=(0,n.useState)(!0),[m,d]=(0,n.useState)(null);(0,n.useEffect)(()=>{g()},[e.daoId,e.walletAddress]);const g=async()=>{try{console.log(`📜 Loading transaction history for ${e.daoName} - ${e.walletAddress}`),c(!0),d(null);const t=r.J.safeGet();if(!t.getRoom(e.daoId))throw new Error("DAO space not found");const n=l.Ay.instance.getChildren(e.daoId).find(e=>{const a=t.getRoom(e.roomId);return a&&a.name&&a.name.toLowerCase().includes("ledger")});if(!n)throw new Error("Ledger room not found");const s=t.getRoom(n.roomId);if(!s)throw new Error("Ledger room not accessible");console.log(`📜 Found ledger room: ${s.name}`);const o=await u(s,e.walletAddress);console.log(`📜 Found ${o.length} transactions for ${e.walletAddress}`),a(o)}catch(e){console.error("Failed to load transaction history:",e),d(e instanceof Error?e.message:"Failed to load transaction history")}finally{c(!1)}},u=async(e,t)=>{const a=[],n=e.getLiveTimeline(),s=(n.getEvents(),r.J.safeGet());try{await s.paginateEventTimeline(n,{backwards:!0,limit:100})}catch(e){console.warn("Failed to paginate timeline:",e)}const o=n.getEvents();console.log(`📜 Processing ${o.length} events from ledger`);for(const e of o){if("m.room.message"!==e.getType())continue;const n=e.getContent();if(!n.transaction_data)continue;const s=n.transaction_data;if(!(s.from===t||s.to===t))continue;const o={type:s.type||"unknown",from:s.from||"",to:s.to||"",amount:Number(s.amount)||0,balance:s.balance,senderBalance:s.senderBalance,recipientBalance:s.recipientBalance,timestamp:s.timestamp?new Date(s.timestamp).getTime():e.getTs(),verifier:s.verifier||"",verifierUserId:s.verifierUserId||"",txHash:s.txHash||"",signature:s.signature,eventId:e.getId()||""};a.push(o)}return a.sort((e,t)=>t.timestamp-e.timestamp)},p=e=>e.length<=12?e:`${e.substring(0,6)}...${e.substring(e.length-6)}`;return n.createElement(s.A,{className:"mx_TransactionHistoryDialog",hasCancel:!0,onFinished:e.onFinished,title:`Transaction History - ${e.daoName} DAO`},n.createElement("div",{className:"mx_TransactionHistoryDialog_content"},i&&n.createElement("div",{className:"mx_TransactionHistoryDialog_loading"},n.createElement(o.A,null),n.createElement("p",null,"Loading transaction history...")),m&&n.createElement("div",{className:"mx_TransactionHistoryDialog_error"},n.createElement("p",null,m)),!i&&!m&&n.createElement("div",{className:"mx_TransactionHistoryDialog_transactions"},0===t.length?n.createElement("div",{className:"mx_TransactionHistoryDialog_empty"},n.createElement("p",null,"No transactions found for this wallet.")):n.createElement("div",{className:"mx_TransactionHistoryDialog_list"},t.map((a,s)=>{const o=(t=>"PoC:issue"===t.type?{label:"Issue",color:"#4caf50"}:"PoC:transfer"===t.type?t.from===e.walletAddress?{label:"Sent",color:"#f44336"}:{label:"Received",color:"#2196f3"}:{label:t.type,color:"#9e9e9e"})(a),r=(t=>{var a,n,s,o;return t.from===e.walletAddress?null!==(a=null!==(n=t.senderBalance)&&void 0!==n?n:t.balance)&&void 0!==a?a:0:null!==(s=null!==(o=t.recipientBalance)&&void 0!==o?o:t.balance)&&void 0!==s?s:0})(a);return n.createElement("div",{key:a.eventId||s,className:"mx_TransactionHistoryDialog_row",style:{marginBottom:s<t.length-1?"16px":"0"}},n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"Type:"),n.createElement("span",{className:"mx_TransactionHistoryDialog_type",style:{color:o.color,marginLeft:"8px"}},o.label)),n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"From/To:"),n.createElement("span",{style:{marginLeft:"8px"}},"PoC:issue"===a.type?"System Issue":a.from===e.walletAddress?`→ ${p(a.to)}`:`← ${p(a.from)}`)),n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"Amount:"),n.createElement("span",{style:{marginLeft:"8px"}},a.amount,"B")),n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"Balance:"),n.createElement("span",{style:{marginLeft:"8px"}},r,"B")),n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"Date:"),n.createElement("span",{style:{marginLeft:"8px"}},(l=a.timestamp,new Date(l).toLocaleString()))),n.createElement("div",{className:"mx_TransactionHistoryDialog_cell"},n.createElement("strong",null,"TX Hash:"),n.createElement("span",{style:{marginLeft:"8px"}},p(a.txHash))));var l})))))}}}]);
//# sourceMappingURL=2656.js.map